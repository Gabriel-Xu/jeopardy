<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeopardy</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: Arial, sans-serif;
        }
        
        .image-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .image-container img {
            max-width: 100%;
            max-height: 100%;
            height: 100%;
            width: auto;
            display: block;
        }

        #myCanvas {
            position: absolute;
            left: 0;
            top: 0;
            pointer-events: none;
            height: 100%;
            width: 100%;
            z-index: 9999;
            /* border: 5px solid black; */
        }

        #timer {
            font-size: 200px;
            font-weight: bold;
            margin: 20px;
            text-align: center;
            font-family:'Courier New', Courier, monospace;
            position: fixed;
            top: 0;
            right: 0;
            padding: 10px;
            background: orange;
        }
    </style>
</head>
<body>
    <div class="image-container" id="imageContainer">
        <img src="image1.jpg" id="targetImage">
        <canvas id="myCanvas"></canvas>
    </div>
    <script>
        let currentSlide = 0;
        const body = document.body;
        
        function updateSlide() {
            document.getElementById('targetImage').src="image"+(currentSlide+1).toString()+".jpg";
        }
        
        var timerElement;
        var timerInterval;
        var used=[];
        var img = document.getElementById('targetImage');
        let rect = img.getBoundingClientRect();
        let rect_w = rect.width;
        let rect_h = rect.height;
        let rect_l = rect.left;
        let rect_t = rect.top;
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        ctx.fillStyle = 'orange';
        let x_vals=[.1,.286,.5,.69,.9];
        let y_vals=[.33,.48,.63,.78,.94];
        let x_w=.15;
        let y_w=.1;
        
        document.addEventListener('click', () => {
            img = document.getElementById('targetImage');
            rect = img.getBoundingClientRect();
            console.log(currentSlide);
            if (timerElement != undefined) {
                timerElement.remove();
                clearInterval(timerInterval);
            }
            if (currentSlide==2) {
                rect_w = rect.width;
                rect_h = rect.height;
                rect_l = rect.left;
                rect_t = rect.top;
                let x = event.clientX - rect.left;
                let y = event.clientY - rect.top;
                x/=rect.width;
                y/=rect.height;
                console.log(x, y);
                var i;
                var j;
                for (i=1; i<=4; i++) {
                    if (x < x_vals[i]) {
                        break;
                    }
                }
                for (j=1; j<=4; j++) {
                    if (y < y_vals[j]) {
                        break;
                    }
                }
                console.log(i, j);
                newSlide = currentSlide;
                if (!(y < y_vals[0] || y > y_vals[4] || x < x_vals[0] || x > x_vals[4]) && !used.includes(""+i+j)) {
                    used.push(""+i+j);
                    newSlide = 3 + 2 * (4*(i-1) + j - 1);
                }
                console.log(i, j, newSlide);
                if (newSlide!=currentSlide) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    let timeLeft = 45;
                    let timer = document.createElement('div');
                    timer.id = 'timer';
                    timer.textContent = '45';
                    document.body.appendChild(timer);
                    timerElement = document.getElementById('timer');
                    timerInterval = setInterval(() => {
                        timeLeft--;
                        timerElement.textContent = timeLeft;
                        
                        if (timeLeft <= 0) {
                            clearInterval(timerInterval);
                            timerElement.textContent = "Time's up!";
                            currentSlide++;
                            timerElement.remove();
                            updateSlide();
                        }
                    }, 1000);
                }
                currentSlide = newSlide;
            }
            else if (currentSlide <= 1) {
                currentSlide++;
            } else {
                currentSlide=2;
                for (let i=0; i<used.length; i++) {
                    let iv=Number(used[i].charAt(0))-1
                    let jv=Number(used[i].charAt(1))-1
                    console.log(used[i], iv, jv);
                    ctx.fillRect(rect_l+(x_vals[iv]+.02)*rect_w, rect_t+(y_vals[jv]+.03)*rect_h, .8*rect_w*(x_vals[iv+1]-x_vals[iv]), .6*(rect_h*(y_vals[jv+1]-y_vals[jv])));
                }
            }
            updateSlide();
        });
        updateSlide();
    </script>
</body>
</html>